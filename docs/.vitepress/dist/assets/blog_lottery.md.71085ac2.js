import{_ as a,o as n,c as l,O as s,z as o}from"./chunks/framework.303c7780.js";const p="/document/assets/firstrotate.a2c06ecd.svg",u=JSON.parse('{"title":"Create lottery-turntable without third-party","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"blog/lottery.md","filePath":"blog/lottery.md"}'),t={name:"blog/lottery.md"},e=s('<h1 id="create-lottery-turntable-without-third-party" tabindex="-1">Create lottery-turntable without third-party <a class="header-anchor" href="#create-lottery-turntable-without-third-party" aria-label="Permalink to &quot;Create lottery-turntable without third-party&quot;">​</a></h1><h2 id="background" tabindex="-1">Background <a class="header-anchor" href="#background" aria-label="Permalink to &quot;Background&quot;">​</a></h2><p>The big turntable is a kind of marketing activity, used to increase users&#39; stickiness.</p><p>With the development of the times, sweepstakes have sprung up like mushrooms after rain. However, the turntable is always the most classic one.</p><p>This article will explains how to make a big turntable with the native ability of React and CSS.</p><h2 id="how-to-make-it-rotating" tabindex="-1">How to make it rotating <a class="header-anchor" href="#how-to-make-it-rotating" aria-label="Permalink to &quot;How to make it rotating&quot;">​</a></h2><p>There are millions of ways to make an HTML element rotate, In this case, we are going to use some native CSS abilities.</p><p><code>transform</code> is the right property to rotate something.</p><p><code>transition</code> is used to simulate acceleration and deceleration.</p><p>For example:</p><div class="language-tsx"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> ele </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getElementById</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">turntable</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">HTMLElement</span></span>\n<span class="line"><span style="color:#A6ACCD;">ele</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">style</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">transition </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">all 6500ms</span><span style="color:#89DDFF;">&#39;</span></span>\n<span class="line"><span style="color:#A6ACCD;">ele</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">style</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">transform </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">rotate(</span><span style="color:#89DDFF;">${</span><span style="color:#A6ACCD;">rotateDeg</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">deg)</span><span style="color:#89DDFF;">`</span></span></code></pre></div><h2 id="calculate-the-degree-of-rotation" tabindex="-1">Calculate the degree of rotation <a class="header-anchor" href="#calculate-the-degree-of-rotation" aria-label="Permalink to &quot;Calculate the degree of rotation&quot;">​</a></h2><p>Before we use <code>transform</code> to rotate anything, the degree of rotation shall be calculated so that the turnable will stop at the right place.</p><h3 id="the-first-rotation" tabindex="-1">The first rotation <a class="header-anchor" href="#the-first-rotation" aria-label="Permalink to &quot;The first rotation&quot;">​</a></h3><p>Suppose the turntable has six petals with 60 degree in each.</p><p>If the turntable starts from <code>petal one</code>, and we want it stops at <code>petal two</code>. We need to give it 300 degrees.</p><div class="language-tsx"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">ele</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">style</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">transform </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">rotate(</span><span style="color:#89DDFF;">${</span><span style="color:#F78C6C;">300</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">deg)</span><span style="color:#89DDFF;">`</span></span></code></pre></div><p>The formula is easy:</p>',18),r=o("img",{src:p,width:"300",alt:"图片名称","align-items":"“center”"},null,-1),c=s(`<h3 id="第二次转动" tabindex="-1">第二次转动 <a class="header-anchor" href="#第二次转动" aria-label="Permalink to &quot;第二次转动&quot;">​</a></h3><p><img src="https://cdn.nlark.com/yuque/0/2023/svg/25790591/1673421476669-ff4c3058-3ff0-4b87-b504-19538f901b13.svg#clientId=ua332647a-7b8f-4&amp;from=drop&amp;height=280&amp;id=oL1Nz&amp;originHeight=1182&amp;originWidth=1029&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=14313&amp;status=done&amp;style=none&amp;taskId=u18b7531c-c65d-4594-9a92-a49a6bc03b8&amp;title=&amp;width=244" alt="无标题-2023-01-11-1446.svg"> 第一次转动结束后转盘停在2号区域，转盘的 <strong>transform: rotate(300deg)</strong>。假设新的中奖区域在3号区域，此时该转动多少度？</p><h4 id="计算方式一" tabindex="-1">计算方式一 <a class="header-anchor" href="#计算方式一" aria-label="Permalink to &quot;计算方式一&quot;">​</a></h4><p>从2到3，也需要<strong>转300度</strong>。因为第一次已经转了300度，所以赋值 <strong>transform: rotate(600deg)</strong>。这个计算方式<strong>既要记录上一次转过的角度，也要计算两者相差的角度。</strong></p><h4 id="计算方式二" tabindex="-1">计算方式二 <a class="header-anchor" href="#计算方式二" aria-label="Permalink to &quot;计算方式二&quot;">​</a></h4><p>因为 transform: rotate(deg) 代表与初始位置的偏差。如果停留在3，那么这个值必然是240加上360的倍数。这个计算方式<strong>只要记录上一次转过的角度</strong>。</p><p>公式更新： <img src="https://cdn.nlark.com/yuque/__latex/ef46c4437e2f5fecb77e9c47c31b0b4c.svg#card=math&amp;code=%0ArotateDeg%20%3D%0A%5Cbegin%7Bcases%7D%0A360%20-%2060%2A%28NumOfArea-1%29%2C%20%20%26%20%5Ctext%7Bif%20%24n%24%20%3D%201%7D%20%5C%5C%0A360%20-%2060%2A%28NumOfArea-1%29%20%2B%20360%2AZ%20%26%20%5Ctext%7Bif%20%24n%24%20%3E%201%7D%0A%5Cend%7Bcases%7D&amp;id=LAGfb" alt=""> Z 代表整数，为保证角度大于上一次角度的最小整数</p><h2 id="代码" tabindex="-1">代码 <a class="header-anchor" href="#代码" aria-label="Permalink to &quot;代码&quot;">​</a></h2><p>归纳上面的内容，我们将大转盘做成一个组件。代码如下：</p><div class="language-tsx"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> LuckyDraw </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 这是react的state管理方式</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">startRotateDeg</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">setStartRotateDeg</span><span style="color:#89DDFF;">]</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">useState</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getTargetDegree</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 随机获取中奖区域</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">prizeIndex</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Math</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">floor</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">Math</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">random</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">6</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 判断中奖与否</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">blankPrize</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">LuckyDrawConstant</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">prizeList</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">prizeIndex</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">blankPrize</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 奖品名</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">name</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">LuckyDrawConstant</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">prizeList</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">prizeIndex</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">name</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 计算角度（标号从0到5）</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">targetDegree</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">360</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">60</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">prizeIndex</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">blankPrize</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">targetDegree</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">handleClick</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 获取目标角度</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">response</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getTargetDegree</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">response</span><span style="color:#89DDFF;">?.</span><span style="color:#A6ACCD;">targetDegree</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">undefined</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">rotateDeg</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">response</span><span style="color:#89DDFF;">?.</span><span style="color:#A6ACCD;">targetDegree</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// 和上次记录的角度作比较，只要小于它，就不断加上360</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">rotateDeg</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">startRotateDeg</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">rotateDeg</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">rotateDeg</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">360</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// 获取转盘实例</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ele</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getElementById</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">turntable</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">HTMLElement</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// 增加旋转动画</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">ele</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">style</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">transition</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">all 6500ms</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// 乘以10是为了转盘转动的效果</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">ele</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">style</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">transform</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">rotate(</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">rotateDeg </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">360</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">deg)</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// 记录上一次旋转到的角度</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">setStartRotateDeg</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">rotateDeg</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">360</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">10</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> (</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">turntable</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        // 大转盘元素</span></span>
<span class="line"><span style="color:#A6ACCD;">        ....</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">onClick</span><span style="color:#89DDFF;">={()</span><span style="color:#C792EA;">=&gt;</span><span style="color:#89DDFF;">{</span><span style="color:#82AAFF;">handleClick</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">}}&gt;&lt;/</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> LuckyDraw</span></span></code></pre></div><p>为了满足业务需求还可以加上复杂的样式和图片。</p>`,11),y=[e,r,c];function F(D,i,C,A,d,h){return n(),l("div",null,y)}const m=a(t,[["render",F]]);export{u as __pageData,m as default};
